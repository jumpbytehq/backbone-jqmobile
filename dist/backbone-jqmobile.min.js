/* ######## APP ############# */window.jumpui={},jumpui.JqmApp=Backbone.Model.extend({initialize:function(){if(this.attributes.platform==undefined)throw"Platform is not specified for this app";if(this.attributes.containerEl==undefined)throw"containerEl is not specified for this app";_.extend(this,this.attributes),this.pages={},this.router=new Backbone.Router,this.platform.setup()},load:function(e){e=e||{};if(this.pages.length<=0)throw"No pages found in app";var t=this;_.each(this.pages,function(e){t.router.route(e.route,e.name,function(){var n=arguments;e.prepare.apply(e,n),_.each(e.blocks,function(e){e.prepare&&e.prepare.apply(e,n)}),e.render(),e.load($(t.containerEl)),t._jQChangePage(e),t.currentPage=e})}),$(this.containerEl).live("pageshow",function(e,t){$(t.prevPage).remove()}),Backbone.history.start(),e.rootPage==undefined?this.router.navigate(_.values(this.pages)[0].name):this.router.navigate(e.rootPage)},addPage:function(e){e.app=this,this.pages[e.name]=e},navigate:function(e){this.router.navigate(e,{trigger:!0})},_jQChangePage:function(e){$.mobile.changePage($(e.el))}}),jumpui.Platform=Backbone.Model.extend({setup:function(){console.log("in setup"),$(document).bind("mobileinit",function(){console.log("hash listening false"),$.mobile.ajaxEnabled=!1,$.mobile.linkBindingEnabled=!1,$.mobile.hashListeningEnabled=!1,$.mobile.pushStateEnabled=!1})}}),jumpui.Platform.CORDOVA=new jumpui.Platform({setup:function(){$.mobile.ajaxEnabled=!1,$.mobile.linkBindingEnabled=!1,$.mobile.hashListeningEnabled=!1,$.mobile.pushStateEnabled=!1}}),jumpui.Platform.WEB=new jumpui.Platform({}),jumpui.template={},jumpui.template.engine={},jumpui.Template=Backbone.Model.extend({parse:function(e,t){return e}}),jumpui.template.engine.Underscore=jumpui.Template.extend({parse:function(e,t){throw"UNDERSCORE not implemented yet"}}),jumpui.template.engine.Handlebars=jumpui.Template.extend({initialize:function(e){_.extend(this,e);var t=this.helpers||{};_.each(_.keys(t),function(e){Handlebars.registerHelper(e,t[e])})},parse:function(e,t){var n=$("#"+e).html(),r=Handlebars.compile(n);return r(t)}}),jumpui.block={},jumpui.Block=Backbone.View.extend({tagName:"div",initialize:function(){_.extend(this,this.options)},render:function(){var e=$(this.el);e.empty();if(this.templateKey){e.append(this.page.app.templateEngine.parse(this.templateKey,this.model));return}if(this.getContent==null)return $(this.el).empty().append("<p>Default Block Content</p>");$(this.el).empty().append($(this.getContent()))}}),jumpui.block.Header=jumpui.Block.extend({className:"jump-header",attributes:{"data-role":"header"}}),jumpui.block.Footer=jumpui.Block.extend({className:"jump-footer",attributes:{"data-role":"footer"}}),jumpui.block.Content=jumpui.Block.extend({className:"jump-content",attributes:{"data-role":"content"}}),jumpui.Page=Backbone.View.extend({tagName:"div",className:"jump-page",attributes:{"data-role":"page"},initialize:function(e){if(e==undefined||e.name==undefined)throw"name property is compulsory";if(e.prepare==undefined)throw"prepare property is compulsory";_.extend(this,e),this.id=e.name,this.loaded=!1,this.route==undefined&&(this.route=this.name),this.setBlocks(e.blocks||{})},setBlocks:function(e){var t=this;this.blocks=e,_.each(this.blocks,function(e){e.page=t})},isLoaded:function(){return!1},load:function(e){e.append(this.el),$(this.el).page(),this.loaded=!0},render:function(){console.log("Rendering "+this.name,this);var e=this;$(e.el).empty(),_.each(_.keys(this.blocks),function(t){var n=e.blocks[t];n.model==undefined&&(n.model={}),_.extend(n.model,n.page.model),n.render(),console.log(e.name+": EL: ",n.el),$(e.el).append(n.el)})}});